(self.webpackChunkvue3_music=self.webpackChunkvue3_music||[]).push([[333],{8333:(t,e,r)=>{"use strict";r.r(e),r.d(e,{default:()=>B});var n=r(6252),s=r(9963),c=r(3577),o=(0,n.HX)("data-v-f6e2960c");(0,n.dD)("data-v-f6e2960c");var i={class:"top"},a=(0,n.Wm)("div",{class:"placeholder"},null,-1),u={class:"topContent"},l={class:"content"},f={class:"searchSuggest"},h=(0,n.Wm)("span",{class:"iconfont"},"",-1);(0,n.Cn)();var p=o((function(t,e,r,p,g,y){var d=(0,n.up)("MusicList"),m=(0,n.up)("Scroll"),w=(0,n.up)("SearchKey");return(0,n.wg)(),(0,n.j4)(n.HY,null,[(0,n.Wm)("div",i,[a,(0,n.Wm)("div",u,[(0,n.Wm)("span",{class:"iconfont",onClick:e[1]||(e[1]=function(){return t.goBack&&t.goBack.apply(t,arguments)})},""),(0,n.Wm)("p",null,[(0,n.wy)((0,n.Wm)("input",{type:"text",placeholder:"搜索歌曲，歌手","onUpdate:modelValue":e[2]||(e[2]=function(e){return t.search=e}),onFocus:e[3]||(e[3]=function(e){return t.isFocus=!0}),onBlur:e[4]||(e[4]=function(e){return t.isFocus=!1})},null,544),[[s.nr,t.search]])]),(0,n.wy)((0,n.Wm)("span",{class:"iconfont",onClick:e[5]||(e[5]=function(e){return t.search=""})},"",512),[[s.F8,t.search]])])]),(0,n.Wm)("div",l,[(0,n.wy)((0,n.Wm)("div",f,[(0,n.Wm)("h3",{class:"bd-btm",onClick:e[6]||(e[6]=function(){return t.toSearchAny&&t.toSearchAny.apply(t,arguments)})},'搜索"'+(0,c.zw)(t.search)+'"',1),((0,n.wg)(!0),(0,n.j4)(n.HY,null,(0,n.Ko)(t.suggestList,(function(e,r){return(0,n.wg)(),(0,n.j4)("dl",{key:r},[(0,n.wy)((0,n.Wm)("dt",{class:"bd-btm"},(0,c.zw)(t.getZn(r))+"：",513),[[s.F8,e.length]]),((0,n.wg)(!0),(0,n.j4)(n.HY,null,(0,n.Ko)(e,(function(e,s){return(0,n.wg)(),(0,n.j4)("dd",{class:"bd-btm",key:s,onClick:function(n){return t.toSearchAny(r,e)}},[h,(0,n.Uk)(" "+(0,c.zw)(e.name),1)],8,["onClick"])})),128))])})),128))],512),[[s.F8,t.suggestShow]]),(0,n.wy)((0,n.Wm)(m,{load:t.load,refresh:t.refresh,limit:t.limit,ref:"scroll"},{default:o((function(){return[(0,n.Wm)(d,{musicList:t.musicList},null,8,["musicList"])]})),_:1},8,["load","refresh","limit"]),[[s.F8,t.musicList.length]]),(0,n.wy)((0,n.Wm)(w,{searchHot:t.searchHot,toSearchAny:t.toSearchAny},null,8,["searchHot","toSearchAny"]),[[s.F8,!t.musicList.length]])])],64)})),g=r(6156),y=r(484),d=r(2137),m=(e=r(7757),r.n(e)),w=r(2262),v=r(2119),b=r(894),S=r(6138),O=r(2730),j=r(9455),k=r(2775),W=r(8771);r=(0,n.HX)("data-v-cf1aee5c");(0,n.dD)("data-v-cf1aee5c");var H={class:"searchKey"},C={class:"hot"},L=(0,n.Wm)("dt",null,"热门搜索",-1),P={class:"history"},F=(0,n.Wm)("dt",null,"搜索历史",-1),Z=(0,n.Wm)("span",{class:"iconfont"},"",-1),x={class:"clear"};function D(t,e){var r,n=Object.keys(t);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(t),e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)),n}function A(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?D(Object(r),!0).forEach((function(e){(0,g.Z)(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):D(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}(0,n.Cn)(),r=r((function(t,e,r,o,i,a){return(0,n.wg)(),(0,n.j4)("div",H,[(0,n.Wm)("dl",C,[L,((0,n.wg)(!0),(0,n.j4)(n.HY,null,(0,n.Ko)(t.searchHot,(function(e,r){return(0,n.wg)(),(0,n.j4)("dd",{key:r,onClick:function(r){return t.toSearchAny(null,e.first)}},(0,c.zw)(e.first),9,["onClick"])})),128))]),(0,n.wy)((0,n.Wm)("dl",P,[F,((0,n.wg)(!0),(0,n.j4)(n.HY,null,(0,n.Ko)(t.history,(function(e,r){return(0,n.wg)(),(0,n.j4)("dd",{class:"bd-btm",key:r},[(0,n.Wm)("div",{onClick:function(r){return t.toSearchAny(null,e)}},[Z,(0,n.Wm)("span",null,(0,c.zw)(e),1)],8,["onClick"]),(0,n.Wm)("span",{class:"iconfont",onClick:(0,s.iM)((function(e){return t.clearHistory(r)}),["stop"])},"",8,["onClick"])])})),128))],512),[[s.F8,t.history.length]]),(0,n.wy)((0,n.Wm)("p",x,[(0,n.Wm)("span",{onClick:e[1]||(e[1]=function(){return t.clearHistory&&t.clearHistory.apply(t,arguments)})},"清除所有记录")],512),[[s.F8,t.history.length]])])}));const I=(0,n.aZ)({name:"SearchKey",props:{toSearchAny:Function},setup:function(){var t=(0,w.qj)({searchHot:[],history:[]});return(0,n.bv)((0,d.Z)(m().mark((function e(){var r;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S.i1.searchHot();case 2:r=e.sent,t.searchHot=r.data.result.hots,window.localStorage.getItem("history")&&(t.history=JSON.parse(window.localStorage.getItem("history"))),k.Z.$on("historyChange",(function(e){t.history=e}));case 6:case"end":return e.stop()}}),e)})))),A(A({},(0,w.BK)(t)),{},{clearHistory:function(e){var r;"number"==typeof e?((r=(0,O.I8)(t.history)).splice(e,1),t.history.splice(e,1),window.localStorage.setItem("history",JSON.stringify(r))):(t.history=[],window.localStorage.setItem("history",JSON.stringify([])))}})}});function K(t,e){var r,n=Object.keys(t);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(t),e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)),n}function q(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?K(Object(r),!0).forEach((function(e){(0,g.Z)(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):K(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}I.render=r,I.__scopeId="data-v-cf1aee5c",r=I;var Y={artists:"歌手",playlists:"歌单",songs:"歌曲"};const _=(0,n.aZ)({name:"MusicSearch",components:{SearchKey:r},setup:function(){var t=(0,v.tv)(),e=(0,b.oR)(),r=(0,w.iH)(null),s=(0,w.qj)({oldSearch:"",search:"",notRequestSuggest:!1,showSuggest:!0,isFocus:!1,suggestList:{songs:[],playlists:[],artists:[]},searchHot:[],musicList:[],limit:30,offset:-30}),c=(0,n.Fl)((function(){return s.search&&s.showSuggest})),o=(0,n.Fl)((function(){return s.search}));(0,n.YP)(o,(function(){o.value?i():s.suggestList={songs:[],playlists:[],artists:[]}}));var i=(a=function(){var t=(0,d.Z)(m().mark((function t(){var e;return m().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o.value&&!s.notRequestSuggest&&s.isFocus){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,S.i1.searchSuggest({keywords:o.value});case 4:e=t.sent,s.suggestList.songs=e.data.result.songs||[],s.suggestList.playlists=e.data.result.playlists||[],s.suggestList.artists=e.data.result.artists||[],s.showSuggest||(s.showSuggest=!0);case 9:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),(0,O.P2)(a)),a=function(){var t=(0,d.Z)(m().mark((function t(){return m().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return l(),t.next=3,u();case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),u=function(){var t=(0,d.Z)(m().mark((function t(){var e,c,o;return m().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s.offset+=s.limit,e={limit:s.limit,offset:s.offset,keywords:s.oldSearch},t.next=4,S.i1.searchMusic(e);case 4:return c=t.sent,o=(0,W.i)(c.data.result.songs),s.notRequestSuggest=!1,s.musicList=s.musicList.concat(o),t.next=10,(0,n.Y3)((function(){o.length<s.limit&&r.value.isFinished()}));case 10:return t.abrupt("return",c.data.result.songs);case 11:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),l=function(){s.showSuggest=!1,s.musicList=[],s.offset=-30,s.oldSearch=s.search,r.value&&r.value.resetScroll()};return q(q({},(0,w.BK)(s)),{},{load:u,refresh:a,suggestShow:c,getZn:function(t){return Y[t]},toSearchAny:function(r,n){switch(s.notRequestSuggest=!0,"string"==typeof n&&(s.search=n),l(),r){case"songs":"object"===(0,y.Z)(n)&&(s.search=s.oldSearch=null==n?void 0:n.name),u();break;case"playlists":"object"===(0,y.Z)(n)&&t.push({name:"musicDetail",query:{id:null==n?void 0:n.id}});break;case"artists":"object"===(0,y.Z)(n)&&(e.dispatch("Home/setCurrentSingers",n),t.push({name:"musicDetail",query:{id:null==n?void 0:n.id,type:"singer"}}));break;default:u()}var c=JSON.parse(window.localStorage.getItem("history"))||[];c.includes(o.value)&&(r=c.indexOf(o.value),c.splice(r,1)),c.unshift(o.value),k.Z.$emit("historyChange",c),window.localStorage.setItem("history",JSON.stringify(c))},scroll:r,playMusics:j.IY,goBack:function(){s.musicList.length?(s.musicList=[],s.search=""):t.back()}})}});_.render=p,_.__scopeId="data-v-f6e2960c";const B=_}}]);